swagger: '2.0'

################################################################################
#                              API Information                                 #
################################################################################
info:
  version: 1.0.0
  title: replacer-reactor
  contact:
    email: ars.anosov@gmail.com
  description: |
    Меняет DOM-элементы сайта. Использует движок [cheerio](https://github.com/cheeriojs/cheerio).

################################################################################
#                  Host, Base Path, Schemes and Content Types                  #
################################################################################
host: '192.168.13.97:8008'
basePath: /v2api
schemes:
  - http

################################################################################
#                                   Tags                                       #
################################################################################
tags:
  - name: http
    description: работа с http
  - name: img
    description: работа с картинками
################################################################################
#                                    Paths                                     #
################################################################################
paths:

  /feed:
    get:
      tags:
        - Http
      summary: Считать index.html с живого сайта
      description: |
        Работает с "Живой лентой":
        1) Стягивает с сайта index.html, парсит DOM
        2) Отдает массив элементов которые отвечают за "Живую ленту"
      operationId: feed_get
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: token
          in: header
          required: true
          type: string
          description: token
        - name: idx
          in: query
          required: false
          type: integer
          description: Порядковый номер новости (с единицы)
      responses:
        '200':
          description: Ok
          schema:
            $ref: '#/definitions/feed_get'
        '202':
          description: no list
          schema:
            $ref: '#/definitions/dummy'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/errorModel'
      x-swagger-router-controller: Http
    post:
      tags:
        - Http
      summary: Добавить DOM-элементы в index.html
      description: Добавляет новость в "Живую ленту" 
      operationId: feed_post
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: token
          in: header
          required: true
          type: string
          description: token
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/feed_add'
          description: |
            Объект с полями, которые соответствуют DOM-элементам
      responses:
        '200':
          description: feed created
          schema:
            $ref: '#/definitions/dummy'
        '202':
          description: feed not created
          schema:
            $ref: '#/definitions/dummy'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/errorModel'
      x-swagger-router-controller: Http
    put:
      tags:
        - Http
      description: Обновляет новость в "Живой ленте"
      operationId: feed_put
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: token
          in: header
          required: true
          type: string
          description: token
        - name: idx
          in: query
          required: true
          type: integer
          description: Порядковый номер новости (с единицы)
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/feed_add'
          description: feed name
      responses:
        '200':
          description: feed updated
          schema:
            $ref: '#/definitions/dummy'
        '202':
          description: feed not updated
          schema:
            $ref: '#/definitions/dummy'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/errorModel'
      x-swagger-router-controller: Http
    delete:
      tags:
        - Http
      description: Обновляет новость в "Живой ленте"
      operationId: feed_del
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: token
          in: header
          description: token
          required: true
          type: string
        - name: idx
          in: query
          required: true
          type: integer
          description: Порядковый номер новости (с единицы)
      responses:
        '200':
          description: feed deleted
          schema:
            $ref: '#/definitions/dummy'
        '202':
          description: feed not deleted
          schema:
            $ref: '#/definitions/dummy'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/errorModel'
      x-swagger-router-controller: Http
    x-swagger-router-controller: Http

  /img:
    get:
      tags:
        - Img
      summary: Получить список доступных картинок
      description: |
        Выдает имена файлов картинок
      operationId: img_get
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: token
          in: header
          required: true
          type: string
          description: token
        - name: filename
          in: query
          required: false
          type: string
          description: имя файла
      responses:
        '200':
          description: Ok
          schema:
            $ref: '#/definitions/img_get'
        '202':
          description: no list
          schema:
            $ref: '#/definitions/dummy'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/errorModel'
      x-swagger-router-controller: Img
    post:
      tags:
        - Img
      summary: Залить картинку
      description: |
        Заливает картинку на сайт 
      operationId: img_post
      produces:
        - application/json
      consumes:
        - multipart/form-data
      parameters:
        - name: token
          in: header
          required: true
          type: string
          description: token
        - name: file
          in: formData
          required: true
          type: file
          description: картинка
      responses:
        '200':
          description: Ok
          schema:
            $ref: '#/definitions/dummy'
        '202':
          description: Image not uploaded
          schema:
            $ref: '#/definitions/dummy'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/errorModel'
      x-swagger-router-controller: Img
    x-swagger-router-controller: Img

################################################################################
#                                 Definitions                                  #
################################################################################
definitions:
# feed_get =======================================================================
  feed_get:
    type: array
    items:
      type: object
      properties:
        short_title:
          type: string
        short_img:
          type: string
        short_comments:
          type: string
        long_title:
          type: string
        long_date:
          type: string
        long_img:
          type: string
        long_content:
          type: string

  feed_add:
    type: object
    properties:
      short_title:
        type: string
      short_img:
        type: string
      short_comments:
        type: string
      long_title:
        type: string
      long_date:
        type: string
      long_img:
        type: string
      long_content:
        type: string

# img_get =======================================================================
  img_get:
    type: array
    items:
      type: string


# System =======================================================================
  errorModel:
    type: object
    required:
      - code
      - message
    properties:
      code:
        type: integer
        format: int32
      message:
        type: string

  dummy:
    type: object
    properties:
      code:
        type: integer
        format: int32
      message:
        type: string